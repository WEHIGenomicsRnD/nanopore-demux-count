process.afterScript = {
    logMainDir = "${params.outdir}/log"
    logMainDir = workflow.launchDir.resolve(logMainDir).toString()

    // Build log directory path based on task name
    logSubDir = task.name.replace(" (null)", "").replace(" ", "/").replaceAll(" ", "_").replaceAll("[()]", "")
    logDir = logMainDir + "/" + logSubDir

    // Define command to copy log files 
    cpLogCmd = "mkdir -p ${logDir}; cp -a nxf_log.tar.gz ${logDir}; "

    // Assemble final command
    cmd =  "ls -alR > .command.ls; "
    cmd += "mkdir nxf_log; "
    cmd += "for file in .command.*; do cp -a \${file} nxf_log/\${file#.}.txt; done; "
    cmd += "tar -czf nxf_log.tar.gz nxf_log;"
    cmd += cpLogCmd
    cmd
}